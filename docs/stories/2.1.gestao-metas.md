# Story 2.1: Gestão de Metas Financeiras

## Status
**Rascunho**

## Story
**Como um** usuário autenticado,
**Eu quero** criar, visualizar, atualizar e excluir metas financeiras, além de registrar contribuições para elas,
**Para que** eu possa planejar e acompanhar meu progresso em direção aos meus objetivos financeiros.

## Contexto do Épico
**Épico:** Funcionalidades Avançadas de Planejamento

**Relacionamento:** Esta é a primeira história do épico de planejamento, focando na capacidade do usuário de definir e gerenciar metas de longo prazo.

**Dependências:**
- História 1.2 (Autenticação de Usuário) deve estar concluída.

## Critérios de Aceitação

1.  **Criação de Meta:**
    -   Endpoint `POST /api/v1/goals` para criar uma nova meta.
    -   Campos obrigatórios: `name`, `targetAmount`, `deadline`.
    -   `currentAmount` deve ser inicializado com `0`.
    -   Validação para garantir que `targetAmount` seja positivo.
    -   A meta criada deve ser associada ao usuário autenticado.

2.  **Listagem de Metas:**
    -   Endpoint `GET /api/v1/goals` para listar todas as metas do usuário.
    -   A resposta deve conter uma lista de metas, cada uma com `id`, `name`, `targetAmount`, `currentAmount`, `deadline`, e `createdAt`.
    -   Apenas metas do usuário autenticado devem ser retornadas.

3.  **Visualização de Meta Específica:**
    -   Endpoint `GET /api/v1/goals/{goal_id}` para obter detalhes de uma meta.
    -   Validação para garantir que a meta pertence ao usuário autenticado.
    -   Retorna 404 se a meta não for encontrada ou não pertencer ao usuário.

4.  **Atualização de Meta:**
    -   Endpoint `PUT /api/v1/goals/{goal_id}` para atualizar os detalhes de uma meta.
    -   Campos editáveis: `name`, `description`, `targetAmount`, `deadline`.
    -   Esta rota não deve ser usada para registrar contribuições.

5.  **Exclusão de Meta:**
    -   Endpoint `DELETE /api/v1/goals/{goal_id}` para excluir uma meta.
    -   Validação de propriedade da meta.
    -   Resposta 204 No Content em caso de sucesso.

6.  **Adicionar Contribuição:**
    -   Endpoint `POST /api/v1/goals/{goal_id}/contribute` para adicionar uma contribuição.
    -   Payload deve conter o `amount` da contribuição.
    -   O `currentAmount` da meta deve ser atualizado.
    -   Validação para garantir que o `amount` da contribuição é positivo.

## Definição de Pronto

- [ ] Código implementado seguindo a Arquitetura Hexagonal.
- [ ] Todos os endpoints de metas (CRUD + contribuição) estão funcionais.
- [ ] Testes unitários e de integração para o serviço e repositório de metas estão passando.
- [ ] Validações de segurança e de negócio estão implementadas.
- [ ] Documentação da API (Swagger/OpenAPI) está atualizada.

## Notas Técnicas

**Modelo de Dados (`goals`):**
```json
{
  "_id": "ObjectId",
  "userId": "ObjectId",
  "name": "String",
  "description": "String",
  "targetAmount": "Decimal128",
  "currentAmount": "Decimal128",
  "deadline": "ISODate",
  "createdAt": "ISODate",
  "updatedAt": "ISODate"
}
```

**Abordagem Técnica:**
-   Implementar `GoalService` no core para a lógica de negócio.
-   Implementar `GoalRepository` como um adaptador de saída para o MongoDB.
-   Criar `goal_controller.py` para expor os endpoints da API.
-   Usar Pydantic para validação de requests e formatação de responses.